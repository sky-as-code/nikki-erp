meta {
  name: Resource Get by name - Client error (Not found)
  type: http
  seq: 2
}

get {
  url: {{api_host}}/v1/authorize/resources/{{resource_name}}Invalid
  body: none
  auth: inherit
}

script:post-response {
  const schema = {
    type: "object",
    required: ["code", "details"],
    properties: {
      code: {
        type: "string",
        const: "validation_error"
      },
      details: {
        type: "object",
        required: ["resource_name"],
        properties: {
          resource_name: {
            type: "string",
            pattern: "not found$"
          }
        },
        additionalProperties: true
      }
    },
    additionalProperties: true
  };
  
  let body;
  try {
    body = res.getBody();
    console.log("üì• Parsed error response:", body);
  } catch (err) {
    console.error("‚ùå Failed to parse error response:", err);
    expect.fail("‚ùå Response body is not valid JSON");
  }
  
  test("Status code is 400", function () {
      expect(res.getStatus()).to.equal(400);
  });
  
  test("Response matches expected error schema", function () {
    expect(tv4.validate(body, schema)).to.be.true;
  });
  
}

settings {
  encodeUrl: true
}
