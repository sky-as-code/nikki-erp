meta {
  name: Role Delete - Client error (Invalid Id format)
  type: http
  seq: 3
}

delete {
  url: {{api_host}}/v1/authorize/roles/123sfsywerr11a&!#$#!ASRQWREQ3!%#
  body: none
  auth: inherit
}

script:post-response {
  const status = res.getStatus();
  let body;
  
  try {
    body = res.getBody();
    console.log("📦 Response:", body);
  } catch (e) {
    console.warn("⚠️ Failed to parse body or body is empty:", e);
    body = {};
  }
  
  // ✅ Check status
  test("status should be 2xx or 400", function () {
    expect([200, 204, 400]).to.include(status);
  });
  
  // ================== Case 1: Success ==================
  if (status >= 200 && status < 300) {
    test("Response should contain id and deletedAt", function () {
      expect(body).to.have.property("id").that.is.a("string");
      expect(body).to.have.property("deletedAt").that.is.a("number");
    });
  
    // Xóa biến role_id khi xóa thành công
    bru.deleteVar("role_id");
    console.log("🧹 Deleted variables: role_id");
  }
  
  // ================== Case 2 & 3: Validation error ==================
  if (status === 400) {
    test("Should have code and details fields", function () {
      expect(body).to.have.property("code", "validation_error");
      expect(body).to.have.property("details").that.is.an("object");
    });
  
    const details = body.details || {};
  
    // Case 2: Role not found
    if (details.role_id === "role not found") {
      test("Should catch role not found", function () {
        expect(details.role_id).to.equal("role not found");
      });
    }
  
    // Case 3: Invalid ID format
    if (details.id === "the length must be exactly 26") {
      test("Should catch invalid id length", function () {
        expect(details.id).to.equal("the length must be exactly 26");
      });
    }
  }
  
}

settings {
  encodeUrl: true
}
